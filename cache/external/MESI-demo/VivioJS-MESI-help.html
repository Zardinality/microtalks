<!DOCTYPE html>
<!-- saved from url=(0064)https://www.scss.tcd.ie/Jeremy.Jones/VivioJS/caches/MESIHelp.htm -->
<html lang="en" class=" vljuljvk idc0_345"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><style type="text/css" id="alertifyCSS">.alertify-logs>*{padding:12px 24px;color:#fff;box-shadow:0 2px 5px 0 rgba(0,0,0,.2);border-radius:1px}.alertify-logs>*,.alertify-logs>.default{background:rgba(0,0,0,.8)}.alertify-logs>.error{background:rgba(244,67,54,.8)}.alertify-logs>.success{background:rgba(76,175,80,.9)}.alertify{position:fixed;background-color:rgba(0,0,0,.3);left:0;right:0;top:0;bottom:0;width:100%;height:100%;z-index:1}.alertify.hide{opacity:0;pointer-events:none}.alertify,.alertify.show{box-sizing:border-box;transition:all .33s cubic-bezier(.25,.8,.25,1)}.alertify,.alertify *{box-sizing:border-box}.alertify .dialog{padding:12px}.alertify .alert,.alertify .dialog{width:100%;margin:0 auto;position:relative;top:50%;transform:translateY(-50%)}.alertify .alert>*,.alertify .dialog>*{width:400px;max-width:95%;margin:0 auto;text-align:center;padding:12px;background:#fff;box-shadow:0 2px 4px -1px rgba(0,0,0,.14),0 4px 5px 0 rgba(0,0,0,.098),0 1px 10px 0 rgba(0,0,0,.084)}.alertify .alert .msg,.alertify .dialog .msg{padding:12px;margin-bottom:12px;margin:0;text-align:left}.alertify .alert input:not(.form-control),.alertify .dialog input:not(.form-control){margin-bottom:15px;width:100%;font-size:100%;padding:12px}.alertify .alert input:not(.form-control):focus,.alertify .dialog input:not(.form-control):focus{outline-offset:-2px}.alertify .alert nav,.alertify .dialog nav{text-align:right}.alertify .alert nav button:not(.btn):not(.pure-button):not(.md-button):not(.mdl-button),.alertify .dialog nav button:not(.btn):not(.pure-button):not(.md-button):not(.mdl-button){background:transparent;box-sizing:border-box;color:rgba(0,0,0,.87);position:relative;outline:0;border:0;display:inline-block;-ms-flex-align:center;-ms-grid-row-align:center;align-items:center;padding:0 6px;margin:6px 8px;line-height:36px;min-height:36px;white-space:nowrap;min-width:88px;text-align:center;text-transform:uppercase;font-size:14px;text-decoration:none;cursor:pointer;border:1px solid transparent;border-radius:2px}.alertify .alert nav button:not(.btn):not(.pure-button):not(.md-button):not(.mdl-button):active,.alertify .alert nav button:not(.btn):not(.pure-button):not(.md-button):not(.mdl-button):hover,.alertify .dialog nav button:not(.btn):not(.pure-button):not(.md-button):not(.mdl-button):active,.alertify .dialog nav button:not(.btn):not(.pure-button):not(.md-button):not(.mdl-button):hover{background-color:rgba(0,0,0,.05)}.alertify .alert nav button:not(.btn):not(.pure-button):not(.md-button):not(.mdl-button):focus,.alertify .dialog nav button:not(.btn):not(.pure-button):not(.md-button):not(.mdl-button):focus{border:1px solid rgba(0,0,0,.1)}.alertify .alert nav button.btn,.alertify .dialog nav button.btn{margin:6px 4px}.alertify-logs{position:fixed;z-index:1}.alertify-logs.bottom,.alertify-logs:not(.top){bottom:16px}.alertify-logs.left,.alertify-logs:not(.right){left:16px}.alertify-logs.left>*,.alertify-logs:not(.right)>*{float:left;transform:translateZ(0);height:auto}.alertify-logs.left>.show,.alertify-logs:not(.right)>.show{left:0}.alertify-logs.left>*,.alertify-logs.left>.hide,.alertify-logs:not(.right)>*,.alertify-logs:not(.right)>.hide{left:-110%}.alertify-logs.right{right:16px}.alertify-logs.right>*{float:right;transform:translateZ(0)}.alertify-logs.right>.show{right:0;opacity:1}.alertify-logs.right>*,.alertify-logs.right>.hide{right:-110%;opacity:0}.alertify-logs.top{top:0}.alertify-logs>*{box-sizing:border-box;transition:all .4s cubic-bezier(.25,.8,.25,1);position:relative;clear:both;backface-visibility:hidden;perspective:1000;max-height:0;margin:0;padding:0;overflow:hidden;opacity:0;pointer-events:none}.alertify-logs>.show{margin-top:12px;opacity:1;max-height:1000px;padding:12px;pointer-events:auto}</style>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- <link rel="canonical" href="https://www.scss.tcd.ie/Jeremy.Jones/caches/MESIHelp.htm"> -->
  <link rel="shortcut icon" type="image/x-icon" href="https://www.scss.tcd.ie/Jeremy.Jones/VivioJS/vivio.ico">
  <title>VivioJS MESI help</title>
  <script src="./VivioJS MESI help_files/funcs.js.download"></script>
  <script src="./VivioJS MESI help_files/vivio.js.download"></script>
  <script src="./VivioJS MESI help_files/MESI.js.download"></script>
  <style>
	.sequence td {
	  padding: 5px;
  	  border: 1px solid black;
  	}
  </style>

<style id="lc9djyoe.v87">rt.katakana-terminator-rt::before { content: attr(data-rt); }</style></head>
<body style="background-color:#e0e0e0;" data-new-gr-c-s-check-loaded="14.1091.0" data-gr-ext-installed="">
  <script>
        header("MESI Cache Coherency Protocol");
  </script><table style="margin-left:2%; width:96%; margin-top:5px">
  <tbody><tr>
    <td style="background-color:#00902a; font-size:x-large; color:white; padding-left:10px; border-radius:5px 5px 5px 5px;">VivioJS</td>
  </tr>
  <tr style="height:5px;"></tr>
  <tr>
    <td id="subtitle" style="background-color:#c0c0c0; font-variant:small-caps; font-size:large; padding-left:10px; border-radius:5px 5px 5px 5px;">MESI Cache Coherency Protocol</td>
  </tr>
</tbody></table>

  <table style="margin-left:2%; width:96%; border:0; border-spacing:0; padding:0;">
    <tbody><tr>
      <td>
        <p style="text-align:justify;">
        This VivioJS animation is designed to help you understand the MESI cache coherency protocol.</p>

        <p style="text-align:justify;">A multiprocessor system is depicted comprising 3 CPUs with local caches and main memory. For simplicity, main memory
        comprises 4 locations a0, a1, a2 and a3. The caches are direct mapped and contain two sets. The even addresses (a0 and a2) map to set 0 whilst the odd
        addresses (a1 and a3) map to set 1.</p>

        <p style="text-align:justify;">NB: in order to simplify this animation, the size of a cache line and that of a CPU read/write operation are identical.
        On a write miss, however, the CPU reads memory even though it will completely overwrite the cache line. This simulates the behaviour of real caches
        where the size of the cache line is usually larger than that of a CPU read/write operation.</p>

      </td>
    </tr>
    <tr>
      <td style="text-align:center; color:red;">
        <!-- tabindex needed for keyboard input -->
        <canvas id="canvas" style="margin: auto; width: 100%; max-width: 1024px; display: block; z-index: 0;" width="1024" height="640">
          No canvas support
        </canvas>
        Click on diagram to activate animation or <a href="https://www.scss.tcd.ie/Jeremy.Jones/VivioJS/caches/MESI.htm">here</a> for a full screen version.
      <canvas width="1024" height="640" style="position: absolute; z-index: 1000; pointer-events: none; overflow: hidden; display: block; left: 394px; top: 1px;"></canvas></td>
    </tr>
    <tr>
      <td>
        <p style="text-align:justify;">Each CPU contains buttons which initiate read or write transactions on the specified memory location. A "CPU write"
        writes an incrementing value (initially 1) to "memory".</p>

        <p style="text-align:justify;">The idea is to press the buttons and see if you can follow the actions and state transitions which occur. It is possible
        to introduce bugs into the animation by pressing the "bug free" button in the top right hand corner. See if you can determine what the bugs are!</p>

        <p style="text-align:justify;">The direction of the traffic on the address and data busses are indicated by blue and red arrows respectively. The cache
        lines and memory location involved in the transaction are coloured green. Stale memory locations are coloured gray.</p>

        <p style="text-align:justify;">A cache line can be in one of 4 states. <b>INVALID:</b> cache line NOT present in cache. <b>EXCLUSIVE:</b> cache line
        present in this cache ONLY and identical to copy in memory. <b>MODIFIED:</b> cache line present in this cache ONLY and memory copy out of date (stale).
        <b>SHARED:</b> cache line in this cache and possibly other caches, ALL copies identical to memory copy. Writes to <b>SHARED</b> cache lines are write
        through whereas writes to <b>EXCLUSIVE</b> cache lines are write-back. If a cache observes a bus transaction for an address which it contains, it
        asserts the SHARED bus line. MESI is an invalidate cache coherency protocol.</p>

        <p style="text-align:justify;">Here is the state transition diagram for a cache line:</p>

        <p><img style="margin:0px auto; max-width:420px; width:100%; display:block; border:0;" src="./VivioJS MESI help_files/MESI.png" alt="MESI state transition diagram"></p>

        <div style="color:red; font-size:larger;">
          <u>Sample sequence to try [from RESET]</u><br>
        </div><br>
        <div>
          <table class="sequence" style="margin-left:2%; width:96%;">
            <tbody><tr>
              <td style="width:5%; text-align:center;">1</td>
              <td style="width:20%;">CPU0: read a0</td>
              <td><i>CPU0 reads a0 from memory <span style="color:red;">[not shared]</span> - state E</i></td>
            </tr>
            <tr>
              <td style="width:5%; text-align:center;">2</td>
              <td style="width:20%;">CPU0: read a0</td>
              <td><i>CPU0 reads a0 from cache - state E</i></td>
            </tr>
            <tr>
              <td style="width:5%; text-align:center;">3</td>
              <td style="width:20%;">CPU0: write a0</td>
              <td><i>CPU0 updates a0 in cache ONLY - state M</i></td>
            </tr>
            <tr>
              <td style="width:5%; text-align:center;">4</td>
              <td style="width:20%;">CPU0: write a0</td>
              <td><i>CPU0 updates a0 in cache ONLY - state M</i></td>
            </tr>
            <tr>
              <td style="width:5%; text-align:center;">5</td>
              <td style="width:20%;">CPU1: read a0</td>
              <td><i>CPU1 reads a0, CPU0 cache intervenes and supplies data to cache and memory - state S</i></td>
            </tr>
            <tr>
              <td style="width:5%; text-align:center;">6</td>
              <td style="width:20%;">CPU1: write a0</td>
              <td><i>CPU1 updates a0 in cache and memory and invalidates all other caches with address a0 - state E</i></td>
            </tr>
            <tr>
              <td style="width:5%; text-align:center;">7</td>
              <td style="width:20%;">CPU1: write a0</td>
              <td><i>CPU1 updates a0 in cache ONLY - state M</i></td>
            </tr>
            <tr>
              <td style="width:5%; text-align:center;">8</td>
              <td style="width:20%;">CPU0: write a0</td>
              <td><i>CPU0 reads a0, CPU1 cache intervenes and supplies data to cache and memory (S), CPU0 then writes to a0 in cache and memory invalidating
              all other caches with address a0 - state</i></td>
            </tr>
            <tr>
              <td style="width:5%; text-align:center;">9</td>
              <td style="width:20%;">CPU0: write a2</td>
              <td><i>CPU0 reads a2 from memory (E) and then writes to a2 - state M</i></td>
            </tr>
            <tr>
              <td style="width:5%; text-align:center;">10</td>
              <td style="width:20%;">CPU0: write a0</td>
              <td><i>CPU0 flushes a2 to memory, reads a2 from memory (E) and then writes to a0 - state M</i></td>
            </tr>
          </tbody></table>
        </div>
      </td>
    </tr>
  </tbody></table><br>
  <script>
	vplayer = new VPlayer("canvas", MESI);
	footer("caches");
  </script><table style="width:96%; margin-left:2%; border-spacing:0">
  <tbody><tr style="font-size:small;">
    <td id="cnt" ;="" style="width:33%; background-color:#00902a; color:white; padding-left:10px; border-radius:5px 0px 0px 5px;">131,338 hits since Jul-05  0.054 secs</td>
    <td style="width:33%; background-color:#00902a; text-align:center; color:white;">Copyright © 2021 jones@scss.tcd.ie</td>
    <td style="text-align:right; background-color:#00902a; color:white; padding-right:10px; border-radius: 0px 5px 5px 0px">last updated: 22-Dec-21</td>
  </tr>
</tbody></table>
<br>



</body><grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration></html>